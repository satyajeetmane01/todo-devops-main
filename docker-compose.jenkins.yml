version: '3.8'

# This Docker Compose file sets up Jenkins for local development/learning
# Usage: docker-compose -f docker-compose.jenkins.yml up -d

services:
  jenkins:
    image: jenkins/jenkins:lts
    container_name: todo-app-jenkins
    
    # Restart policy - Jenkins will restart if it crashes
    restart: unless-stopped
    
    # Ports to expose
    ports:
      - "8080:8080"   # Jenkins Web UI
      - "50000:50000" # Jenkins agent communication
    
    # Volumes - persist Jenkins data
    volumes:
      # Jenkins home directory (stores all configs, jobs, plugins)
      - jenkins_home:/var/jenkins_home
      
      # Mount Docker socket to allow Jenkins to run Docker commands
      # (useful for advanced pipelines)
      - /var/run/docker.sock:/var/run/docker.sock
      
      # Optional: Mount your project directory
      # This makes it easier to test locally without Git
      - ./:/workspace/todo-app:ro
    
    # Environment variables
    environment:
      # Java options for Jenkins
      - JAVA_OPTS=-Djenkins.install.runSetupWizard=false
      
      # Jenkins options
      - JENKINS_OPTS=--httpPort=8080
    
    # User and group IDs (adjust if needed)
    # This ensures file permissions work correctly
    user: root
    
    # Health check to ensure Jenkins is running properly
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8080/login || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

# Named volumes for data persistence
volumes:
  jenkins_home:
    driver: local

# Networks (optional, but good practice)
networks:
  default:
    name: jenkins-network

